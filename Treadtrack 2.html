<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TreadTrack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --card: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --radius: 14px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 16px 16px 32px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .title {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #22d3ee);
      color: #022c22;
      font-weight: 600;
    }

    .tabs {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      background: rgba(15, 23, 42, 0.8);
      padding: 4px;
      border-radius: 999px;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .tab {
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 8px 4px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
    }

    .tab.active {
      background: radial-gradient(circle at top, #38bdf8, #0ea5e9);
      color: #0b1120;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8),
        0 10px 25px rgba(56, 189, 248, 0.35);
    }

    .card {
      background: radial-gradient(circle at top left, #1f2937, #020617);
      border-radius: var(--radius);
      padding: 14px 14px 16px;
      margin-bottom: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(18px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .card-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.75rem;
      color: var(--muted);
    }

    input,
    textarea {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 8px 10px;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }

    input:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    textarea {
      border-radius: 10px;
      resize: vertical;
      min-height: 60px;
    }

    .button-primary {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 14px;
      font-size: 0.95rem;
      font-weight: 600;
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #020617;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 14px 35px rgba(56, 189, 248, 0.45);
    }

    .button-primary:active {
      transform: translateY(1px);
      box-shadow: 0 8px 20px rgba(56, 189, 248, 0.35);
    }

    .button-ghost {
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 6px 10px;
      font-size: 0.75rem;
      background: rgba(15, 23, 42, 0.7);
      color: var(--muted);
      cursor: pointer;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .stat {
      background: radial-gradient(circle at top, #020617, #020617);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .stat-value {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .stat-tag {
      font-size: 0.7rem;
      color: var(--accent);
    }

    .runs-list {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
    }

    .run-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
    }

    .run-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .run-distance {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .run-date {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .run-notes {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .badges-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .badge {
      border-radius: 12px;
      padding: 8px 10px;
      background: radial-gradient(circle at top left, #0f172a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .badge-icon {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }

    .badge-content {
      flex: 1;
    }

    .badge-title {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .badge-desc {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .badge-meta {
      font-size: 0.65rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .badge-distance {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .badge-consistency {
      background: rgba(249, 115, 22, 0.15);
      color: #fb923c;
    }

    .badge-pb {
      background: rgba(74, 222, 128, 0.15);
      color: #4ade80;
    }

    .empty {
      font-size: 0.8rem;
      color: var(--muted);
      text-align: center;
      padding: 10px 4px 4px;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      color: #022c22;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      box-shadow: 0 16px 40px rgba(22, 163, 74, 0.6);
      display: none;
      z-index: 50;
    }

    .toast.show {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .toast span {
      font-size: 0.9rem;
    }

    .hint {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 6px;
      text-align: center;
    }

    @media (max-width: 400px) {
      .card {
        padding: 12px;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .badges-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">
          <span>treadtrack</span>
          <span class="title-badge">treadmill km</span>
        </div>
        <div class="card-subtitle">Quick logging ‚Ä¢ Milestones ‚Ä¢ Badges</div>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="log">Log</button>
      <button class="tab" data-tab="stats">Stats</button>
      <button class="tab" data-tab="badges">Badges</button>
    </div>

    <!-- LOG TAB -->
    <section class="card tab-panel" data-panel="log">
      <div class="card-header">
        <div>
          <div class="card-title">Log run</div>
          <div class="card-subtitle">Distance in kilometres</div>
        </div>
        <span class="pill">Today</span>
      </div>

      <div class="form-grid">
        <div class="field">
          <label>Distance (km) *</label>
          <input id="distance" type="number" step="0.01" min="0" placeholder="e.g. 3.50" />
        </div>
        <div class="field">
          <label>Duration (min)</label>
          <input id="duration" type="number" step="1" min="0" placeholder="optional" />
        </div>
        <div class="field">
          <label>Incline (%)</label>
          <input id="incline" type="number" step="0.5" min="0" placeholder="optional" />
        </div>
        <div class="field">
          <label>Notes</label>
          <input id="notes" type="text" maxlength="80" placeholder="felt strong, intervals, etc." />
        </div>
      </div>

      <button class="button-primary" id="saveRun">
        <span>Save run</span>
        <span>‚ûï</span>
      </button>
      <div class="hint">
        Tip: Add this page to your home screen to use it like an app.
      </div>
    </section>

    <!-- STATS TAB -->
    <section class="card tab-panel" data-panel="stats" style="display:none;">
      <div class="card-header">
        <div>
          <div class="card-title">Progress</div>
          <div class="card-subtitle">Your treadmill history</div>
        </div>
        <button class="button-ghost" id="clearData">Reset data</button>
      </div>

      <div class="stats-grid" id="statsGrid"></div>

      <div class="card-subtitle" style="margin-top:10px;">Recent runs</div>
      <div class="runs-list" id="runsList"></div>
    </section>

    <!-- BADGES TAB -->
    <section class="card tab-panel" data-panel="badges" style="display:none;">
      <div class="card-header">
        <div>
          <div class="card-title">Badges</div>
          <div class="card-subtitle">Distance ‚Ä¢ Consistency ‚Ä¢ Personal best</div>
        </div>
      </div>

      <div id="badgesGrid"></div>
      <div class="hint">
        New milestones unlock automatically as you log more runs.
      </div>
    </section>
  </div>

  <div class="toast" id="toast">
    <span>üèÖ</span>
    <span id="toastText"></span>
  </div>

  <script>
    // --- Data model & storage ---
    const STORAGE_KEY = "treadtrack-data-v1";

    const distanceMilestones = [
      { threshold: 10, title: "Warmup Complete", desc: "You‚Äôve run 10 km in total.", type: "distance" },
      { threshold: 25, title: "5K x5", desc: "25 km total distance.", type: "distance" },
      { threshold: 50, title: "Half-Century Runner", desc: "50 km total distance.", type: "distance" },
      { threshold: 100, title: "Century Runner", desc: "100 km total distance.", type: "distance" },
      { threshold: 250, title: "Quarter to a Thousand", desc: "250 km total distance.", type: "distance" },
      { threshold: 500, title: "Half to a Thousand", desc: "500 km total distance.", type: "distance" },
      { threshold: 1000, title: "Millennium Runner", desc: "1000 km total distance.", type: "distance" }
    ];

    const consistencyMilestones = [
      { id: "week-3", threshold: 3, title: "Finding Your Rhythm", desc: "3 runs this week.", type: "consistency" },
      { id: "month-10", threshold: 10, title: "Habit Builder", desc: "10 runs this month.", type: "consistency" },
      { id: "streak-30", threshold: 30, title: "Unbreakable", desc: "30-day running streak.", type: "consistency" },
      { id: "runs-100", threshold: 100, title: "Triple-Digit Grinder", desc: "100 total runs logged.", type: "consistency" }
    ];

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { runs: [], badges: [] };
        return JSON.parse(raw);
      } catch {
        return { runs: [], badges: [] };
      }
    }

    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    // --- Helpers ---
    function formatDate(d) {
      const date = new Date(d);
      return date.toLocaleDateString(undefined, {
        day: "2-digit",
        month: "short",
        year: "2-digit"
      });
    }

    function today() {
      const d = new Date();
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function isSameDay(a, b) {
      return (
        a.getFullYear() === b.getFullYear() &&
        a.getMonth() === b.getMonth() &&
        a.getDate() === b.getDate()
      );
    }

    function getStats() {
      const runs = state.runs.map(r => ({ ...r, date: new Date(r.date) }));
      const totalDistance = runs.reduce((sum, r) => sum + r.distanceKm, 0);
      const longestRun = runs.reduce((max, r) => Math.max(max, r.distanceKm), 0);

      const now = new Date();
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday start
      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);

      const runsThisWeek = runs.filter(r => r.date >= startOfWeek).length;
      const runsThisMonth = runs.filter(r => r.date >= startOfMonth).length;

      // streak: consecutive days with at least one run, counting back from today
      let streak = 0;
      let offset = 0;
      while (true) {
        const day = new Date();
        day.setDate(day.getDate() - offset);
        const hasRun = runs.some(r => isSameDay(r.date, day));
        if (hasRun) {
          streak++;
          offset++;
        } else {
          break;
        }
      }

      return {
        totalDistance,
        longestRun,
        runsThisWeek,
        runsThisMonth,
        streak,
        totalRuns: runs.length
      };
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      const text = document.getElementById("toastText");
      text.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2600);
    }

    // --- Milestones / badges ---
    function ensureBadge(badgeId) {
      if (!state.badges.some(b => b.id === badgeId)) {
        const badge = { id: badgeId, unlockedAt: new Date().toISOString() };
        state.badges.push(badge);
        saveState(state);
        return true;
      }
      return false;
    }

    function checkDistanceBadges(stats) {
      let unlocked = [];
      distanceMilestones.forEach(m => {
        if (stats.totalDistance >= m.threshold) {
          const id = `distance-${m.threshold}`;
          if (ensureBadge(id)) {
            unlocked.push(m.title);
          }
        }
      });
      return unlocked;
    }

    function checkConsistencyBadges(stats) {
      let unlocked = [];
      consistencyMilestones.forEach(m => {
        if (m.id === "week-3" && stats.runsThisWeek >= m.threshold) {
          if (ensureBadge(m.id)) unlocked.push(m.title);
        }
        if (m.id === "month-10" && stats.runsThisMonth >= m.threshold) {
          if (ensureBadge(m.id)) unlocked.push(m.title);
        }
        if (m.id === "streak-30" && stats.streak >= m.threshold) {
          if (ensureBadge(m.id)) unlocked.push(m.title);
        }
        if (m.id === "runs-100" && stats.totalRuns >= m.threshold) {
          if (ensureBadge(m.id)) unlocked.push(m.title);
        }
      });
      return unlocked;
    }

    function checkPersonalBestBadges(newRun, statsBefore) {
      const unlocked = [];
      if (newRun.distanceKm >= statsBefore.longestRun && newRun.distanceKm > 0) {
        const id = `pb-longest-${newRun.distanceKm.toFixed(2)}`;
        if (ensureBadge(id)) {
          unlocked.push("New Longest Run");
        }
      }
      return unlocked;
    }

    function getBadgeDetails(badgeId) {
      if (badgeId.startsWith("distance-")) {
        const threshold = Number(badgeId.split("-")[1]);
        const m = distanceMilestones.find(d => d.threshold === threshold);
        return { ...m, id: badgeId };
      }
      const cons = consistencyMilestones.find(c => c.id === badgeId);
      if (cons) return cons;
      if (badgeId.startsWith("pb-longest-")) {
        const km = Number(badgeId.replace("pb-longest-", ""));
        return {
          id: badgeId,
          type: "personalBest",
          title: "New Longest Run",
          desc: `You hit a new longest run: ${km.toFixed(2)} km.`
        };
      }
      return null;
    }

    // --- Rendering ---
    function renderStats() {
      const stats = getStats();
      const grid = document.getElementById("statsGrid");
      grid.innerHTML = `
        <div class="stat">
          <div class="stat-label">Total distance</div>
          <div class="stat-value">${stats.totalDistance.toFixed(2)} km</div>
          <div class="stat-tag">All time</div>
        </div>
        <div class="stat">
          <div class="stat-label">Longest run</div>
          <div class="stat-value">${stats.longestRun.toFixed(2)} km</div>
          <div class="stat-tag">Single session</div>
        </div>
        <div class="stat">
          <div class="stat-label">Runs this week</div>
          <div class="stat-value">${stats.runsThisWeek}</div>
          <div class="stat-tag">Consistency</div>
        </div>
        <div class="stat">
          <div class="stat-label">Current streak</div>
          <div class="stat-value">${stats.streak} days</div>
          <div class="stat-tag">Daily running</div>
        </div>
      `;

      const runsList = document.getElementById("runsList");
      if (state.runs.length === 0) {
        runsList.innerHTML = `<div class="empty">No runs logged yet.</div>`;
        return;
      }
      const sorted = [...state.runs].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );
      runsList.innerHTML = sorted
        .map(r => {
          const date = formatDate(r.date);
          const notes = r.notes ? `<div class="run-notes">${r.notes}</div>` : "";
          return `
            <div class="run-item">
              <div class="run-top">
                <div class="run-distance">${r.distanceKm.toFixed(2)} km</div>
                <div class="run-date">${date}</div>
              </div>
              ${notes}
            </div>
          `;
        })
        .join("");
    }

    function renderBadges() {
      const container = document.getElementById("badgesGrid");
      if (state.badges.length === 0) {
        container.innerHTML = `<div class="empty">No badges yet. Log some runs to start unlocking milestones.</div>`;
        return;
      }
      const sorted = [...state.badges].sort(
        (a, b) => new Date(b.unlockedAt) - new Date(a.unlockedAt)
      );
      container.innerHTML = `
        <div class="badges-grid">
          ${sorted
            .map(b => {
              const details = getBadgeDetails(b.id);
              if (!details) return "";
              const date = formatDate(b.unlockedAt);
              let icon = "üèÖ";
              let badgeClass = "badge-distance";
              if (details.type === "consistency") {
                icon = "üî•";
                badgeClass = "badge-consistency";
              }
              if (details.type === "personalBest") {
                icon = "‚≠ê";
                badgeClass = "badge-pb";
              }
              return `
                <div class="badge">
                  <div class="badge-icon ${badgeClass}">${icon}</div>
                  <div class="badge-content">
                    <div class="badge-title">${details.title}</div>
                    <div class="badge-desc">${details.desc}</div>
                    <div class="badge-meta">Unlocked ${date}</div>
                  </div>
                </div>
              `;
            })
            .join("")}
        </div>
      `;
    }

    function renderAll() {
      renderStats();
      renderBadges();
    }

    // --- Event handlers ---
    document.getElementById("saveRun").addEventListener("click", () => {
      const distanceInput = document.getElementById("distance");
      const durationInput = document.getElementById("duration");
      const inclineInput = document.getElementById("incline");
      const notesInput = document.getElementById("notes");

      const distance = parseFloat(distanceInput.value);
      if (isNaN(distance) || distance <= 0) {
        distanceInput.focus();
        distanceInput.style.borderColor = "#f97373";
        setTimeout(() => (distanceInput.style.borderColor = ""), 800);
        return;
      }

      const duration = durationInput.value ? parseFloat(durationInput.value) : null;
      const incline = inclineInput.value ? parseFloat(inclineInput.value) : null;
      const notes = notesInput.value.trim() || null;

      const newRun = {
        id: crypto.randomUUID(),
        date: new Date().toISOString(),
        distanceKm: distance,
        durationMinutes: duration,
        incline,
        notes
      };

      const statsBefore = getStats();
      state.runs.push(newRun);
      saveState(state);

      const statsAfter = getStats();
      const unlocked = [
        ...checkDistanceBadges(statsAfter),
        ...checkConsistencyBadges(statsAfter),
        ...checkPersonalBestBadges(newRun, statsBefore)
      ];

      saveState(state);
      renderAll();

      distanceInput.value = "";
      durationInput.value = "";
      inclineInput.value = "";
      notesInput.value = "";

      if (unlocked.length > 0) {
        showToast(`New badge: ${unlocked[0]}`);
      } else {
        showToast("Run saved");
      }
    });

    document.getElementById("clearData").addEventListener("click", () => {
      if (!confirm("Reset all runs and badges?")) return;
      state = { runs: [], badges: [] };
      saveState(state);
      renderAll();
    });

    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        const target = tab.getAttribute("data-tab");
        document
          .querySelectorAll(".tab")
          .forEach(t => t.classList.toggle("active", t === tab));
        document.querySelectorAll(".tab-panel").forEach(panel => {
          panel.style.display =
            panel.getAttribute("data-panel") === target ? "block" : "none";
        });
      });
    });

    renderAll();
  </script>
</body>
</html>
